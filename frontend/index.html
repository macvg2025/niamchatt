<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NiamChat - Real-time Chat by NiamVerse</title>
    <meta name="description" content="Real-time chatting application with public and private rooms, message reactions, and custom themes.">
    <meta name="author" content="NiamVerse">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ’¬</text></svg>">
    
    <!-- Open Graph / Social Media -->
    <meta property="og:title" content="NiamChat - Real-time Chat">
    <meta property="og:description" content="Chat with friends in public or private rooms. Features message reactions, themes, and admin system.">
    <meta property="og:type" content="website">
    
    <!-- Styles -->
    <link rel="stylesheet" href="/style.css">
    
    <!-- Preconnect to external resources -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- PWA Manifest (optional future enhancement) -->
    <!-- <link rel="manifest" href="/manifest.json"> -->
</head>
<body>
    <!-- Root element for React -->
    <div id="root"></div>
    
    <!-- Hidden audio element for message sounds -->
    <audio id="messageSound" preload="auto" style="display: none;">
        <!-- Fallback sound will be generated if msg.mp3 not found -->
    </audio>
    
    <!-- Preload critical assets -->
    <link rel="preload" href="/style.css" as="style">
    
    <!-- Scripts -->
    <script type="module" src="/main.jsx"></script>
    
    <!-- Detect iframe/sidebar mode -->
    <script>
        // Detect if we're in an iframe and apply appropriate mode
        (function() {
            // Check if we're embedded in an iframe
            if (window.self !== window.top) {
                document.body.classList.add('iframe-mode');
                
                // Check if the iframe is narrow (sidebar mode)
                const checkWidth = () => {
                    if (window.innerWidth <= 768) {
                        document.body.classList.add('sidebar-mode');
                        document.body.classList.remove('mobile-mode');
                    } else {
                        document.body.classList.remove('sidebar-mode');
                    }
                };
                
                // Initial check
                checkWidth();
                
                // Re-check on resize
                window.addEventListener('resize', checkWidth);
                
                console.log('NiamChat: Running in iframe mode');
            }
            
            // Listen for messages from parent site
            window.addEventListener('message', function(event) {
                // For security, you could check the origin:
                // if (event.origin !== 'https://your-gaming-site.com') return;
                
                if (event.data && event.data.type === 'SET_MODE') {
                    console.log('NiamChat: Received mode:', event.data.mode);
                    document.body.classList.add(event.data.mode + '-mode');
                }
            });
            
            // Auto-detect mobile
            if (window.innerWidth <= 768 && window.self === window.top) {
                document.body.classList.add('mobile-mode');
                console.log('NiamChat: Mobile mode detected');
            }
            
            // Load message sound
            const messageSound = document.getElementById('messageSound');
            try {
                // Try to load from server
                messageSound.src = '/msg.mp3';
                messageSound.load();
            } catch (error) {
                console.log('NiamChat: Using fallback sound system');
                // Fallback will be generated by React
            }
            
            // Performance monitoring
            window.addEventListener('load', function() {
                console.log('NiamChat: Application loaded');
            });
        })();
    </script>
    
    <!-- Fallback for browsers without JavaScript -->
    <noscript>
        <style>
            body {
                display: flex;
                justify-content: center;
                align-items: center;
                min-height: 100vh;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                text-align: center;
                padding: 20px;
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            }
            .nojs-message {
                background: rgba(255, 255, 255, 0.1);
                padding: 40px;
                border-radius: 20px;
                backdrop-filter: blur(10px);
                max-width: 500px;
            }
        </style>
        <div class="nojs-message">
            <h1>NiamChat</h1>
            <p>This application requires JavaScript to function.</p>
            <p>Please enable JavaScript in your browser settings to use NiamChat.</p>
            <p style="margin-top: 30px; font-size: 0.9em; opacity: 0.8;">
                NiamChat is a real-time chat application built with modern web technologies.
            </p>
        </div>
    </noscript>
</body>
</html>
